// Author: ClÃ¡udio Gomes (TofuLynx)
// Project: emubayer
// License: GNU GPL Version 3 (https://www.gnu.org/licenses/gpl-3.0.en.html)

use super::*;

fn get_input_vector() -> Vec<u8> {
    // R->1 G->2 B->3
    vec![
        1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3,
        1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3,
        1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3,
        1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3,
        1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3,
        1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3,
        1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3,
        1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3,
    ]
}

#[test]
fn test_image_extract_rggb() {
    let rgb_image = RgbImage {
        width: 8,
        height: 8,
        data: get_input_vector(),
        bit_depth: BitDepth::Eight,
    };

    let raw_image = rgb_image.to_raw(BayerPattern::RGGB);

    assert_eq!(raw_image.data, vec![
        1<<8, 2<<8, 1<<8, 2<<8, 1<<8, 2<<8, 1<<8, 2<<8,
        2<<8, 3<<8, 2<<8, 3<<8, 2<<8, 3<<8, 2<<8, 3<<8,
        1<<8, 2<<8, 1<<8, 2<<8, 1<<8, 2<<8, 1<<8, 2<<8,
        2<<8, 3<<8, 2<<8, 3<<8, 2<<8, 3<<8, 2<<8, 3<<8,
        1<<8, 2<<8, 1<<8, 2<<8, 1<<8, 2<<8, 1<<8, 2<<8,
        2<<8, 3<<8, 2<<8, 3<<8, 2<<8, 3<<8, 2<<8, 3<<8,
        1<<8, 2<<8, 1<<8, 2<<8, 1<<8, 2<<8, 1<<8, 2<<8,
        2<<8, 3<<8, 2<<8, 3<<8, 2<<8, 3<<8, 2<<8, 3<<8,
    ]);
}

#[test]
fn test_image_extract_bggr() {
    let rgb_image = RgbImage {
        width: 8,
        height: 8,
        data: get_input_vector(),
        bit_depth: BitDepth::Eight,
    };

    let raw_image = rgb_image.to_raw(BayerPattern::BGGR);

    assert_eq!(raw_image.data, vec![
        3<<8, 2<<8, 3<<8, 2<<8, 3<<8, 2<<8, 3<<8, 2<<8,
        2<<8, 1<<8, 2<<8, 1<<8, 2<<8, 1<<8, 2<<8, 1<<8,
        3<<8, 2<<8, 3<<8, 2<<8, 3<<8, 2<<8, 3<<8, 2<<8,
        2<<8, 1<<8, 2<<8, 1<<8, 2<<8, 1<<8, 2<<8, 1<<8,
        3<<8, 2<<8, 3<<8, 2<<8, 3<<8, 2<<8, 3<<8, 2<<8,
        2<<8, 1<<8, 2<<8, 1<<8, 2<<8, 1<<8, 2<<8, 1<<8,
        3<<8, 2<<8, 3<<8, 2<<8, 3<<8, 2<<8, 3<<8, 2<<8,
        2<<8, 1<<8, 2<<8, 1<<8, 2<<8, 1<<8, 2<<8, 1<<8,
    ]);
}

#[test]
fn test_image_extract_grbg() {
    let rgb_image = RgbImage {
        width: 8,
        height: 8,
        data: get_input_vector(),
        bit_depth: BitDepth::Eight,
    };

    let raw_image = rgb_image.to_raw(BayerPattern::GRBG);

    assert_eq!(raw_image.data, vec![
        2<<8, 1<<8, 2<<8, 1<<8, 2<<8, 1<<8, 2<<8, 1<<8,
        3<<8, 2<<8, 3<<8, 2<<8, 3<<8, 2<<8, 3<<8, 2<<8,
        2<<8, 1<<8, 2<<8, 1<<8, 2<<8, 1<<8, 2<<8, 1<<8,
        3<<8, 2<<8, 3<<8, 2<<8, 3<<8, 2<<8, 3<<8, 2<<8,
        2<<8, 1<<8, 2<<8, 1<<8, 2<<8, 1<<8, 2<<8, 1<<8,
        3<<8, 2<<8, 3<<8, 2<<8, 3<<8, 2<<8, 3<<8, 2<<8,
        2<<8, 1<<8, 2<<8, 1<<8, 2<<8, 1<<8, 2<<8, 1<<8,
        3<<8, 2<<8, 3<<8, 2<<8, 3<<8, 2<<8, 3<<8, 2<<8,
    ]);
}

#[test]
fn test_image_extract_gbrg() {
    let rgb_image = RgbImage {
        width: 8,
        height: 8,
        data: get_input_vector(),
        bit_depth: BitDepth::Eight,
    };

    let raw_image = rgb_image.to_raw(BayerPattern::GBRG);

    assert_eq!(raw_image.data, vec![
        2<<8, 3<<8, 2<<8, 3<<8, 2<<8, 3<<8, 2<<8, 3<<8,
        1<<8, 2<<8, 1<<8, 2<<8, 1<<8, 2<<8, 1<<8, 2<<8,
        2<<8, 3<<8, 2<<8, 3<<8, 2<<8, 3<<8, 2<<8, 3<<8,
        1<<8, 2<<8, 1<<8, 2<<8, 1<<8, 2<<8, 1<<8, 2<<8,
        2<<8, 3<<8, 2<<8, 3<<8, 2<<8, 3<<8, 2<<8, 3<<8,
        1<<8, 2<<8, 1<<8, 2<<8, 1<<8, 2<<8, 1<<8, 2<<8,
        2<<8, 3<<8, 2<<8, 3<<8, 2<<8, 3<<8, 2<<8, 3<<8,
        1<<8, 2<<8, 1<<8, 2<<8, 1<<8, 2<<8, 1<<8, 2<<8,
    ]);
}